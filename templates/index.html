<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Koree Autoservice - Betrouwbare Autoservice in Maassluis</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Koree Autoservice in Maassluis. APK keuringen, onderhoud, reparaties en meer. Boek online uw afspraak. Ervaren en betrouwbaar.">
    <meta name="keywords" content="autoservice, APK keuring, auto onderhoud, Maassluis, auto reparatie">
    
    <!-- Stylesheets -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>
<body>
    <!-- WhatsApp Floating Button -->
    <div class="whatsapp-float">
        <a href="https://wa.me/31623967989?text=Hallo,%20ik%20zou%20graag%20een%20afspraak%20maken" target="_blank">
            <i class="fab fa-whatsapp"></i>
        </a>
    </div>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#home">
                <span class="fw-bold">Koree Autoservice</span>
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#home">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#services">Diensten</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#about">Over Ons</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#reviews">Reviews</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#contact">Contact</a>
                    </li>
                    <li class="nav-item">
                        <a class="btn btn-primary ms-2" href="#booking">
                            <i class="fas fa-calendar-plus"></i> Afspraak Maken
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section id="home" class="hero-section">
        <div class="container">
            <div class="row align-items-center min-vh-100">
                <div class="col-lg-6">
                    <div class="hero-content">
                        <h1 class="display-4 fw-bold mb-4">
                            Betrouwbare <span class="text-warning">Autoservice</span> in Maassluis
                        </h1>
                        <p class="lead mb-4">
                            Al meer dan 15 jaar uw vertrouwde partner voor APK keuringen, onderhoud, 
                            reparaties en meer. Vakkundig, eerlijk en betaalbaar.
                        </p>
                        <div class="hero-buttons">
                            <a href="#booking" class="btn btn-primary btn-lg me-3">
                                <i class="fas fa-calendar-plus"></i> Afspraak Maken
                            </a>
                            <a href="https://wa.me/31623967989" class="btn btn-success btn-lg" target="_blank">
                                <i class="fab fa-whatsapp"></i> WhatsApp
                            </a>
                        </div>
                        
                        <div class="hero-features mt-5">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="feature-item">
                                        <i class="fas fa-certificate text-warning"></i>
                                        <span>Erkend APK Station</span>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="feature-item">
                                        <i class="fas fa-clock text-warning"></i>
                                        <span>Snelle Service</span>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="feature-item">
                                        <i class="fas fa-shield-alt text-warning"></i>
                                        <span>Garantie</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="hero-image text-center">
                        <i class="fas fa-car fa-10x text-white opacity-75"></i>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Services Section -->
    <section id="services" class="services-preview py-5">
        <div class="container">
            <div class="text-center mb-5">
                <h2 class="display-5 fw-bold">Onze Diensten</h2>
                <p class="lead">Compleet autobedrijf voor al uw autowensen</p>
            </div>
            
            <div class="row g-4" id="servicesContainer">
                <!-- Services will be loaded here -->
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="py-5 bg-light">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-6">
                    <h2 class="display-5 fw-bold mb-4">Over Koree Autoservice</h2>
                    <p class="lead mb-4">
                        Sinds 2008 bieden wij kwalitatieve autoservices in Maassluis en omgeving. 
                        Ons ervaren team zorgt ervoor dat uw voertuig altijd in topconditie is.
                    </p>
                    <div class="row">
                        <div class="col-md-6">
                            <h5><i class="fas fa-check text-success me-2"></i>Gecertificeerde Monteurs</h5>
                            <p>Al onze monteurs zijn volledig gecertificeerd en ervaren.</p>
                        </div>
                        <div class="col-md-6">
                            <h5><i class="fas fa-check text-success me-2"></i>Moderne Apparatuur</h5>
                            <p>Wij gebruiken de nieuwste diagnostische apparatuur.</p>
                        </div>
                        <div class="col-md-6">
                            <h5><i class="fas fa-check text-success me-2"></i>Eerlijke Prijzen</h5>
                            <p>Transparante prijsstelling zonder verborgen kosten.</p>
                        </div>
                        <div class="col-md-6">
                            <h5><i class="fas fa-check text-success me-2"></i>Snelle Service</h5>
                            <p>Meeste reparaties worden dezelfde dag uitgevoerd.</p>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6 text-center">
                    <i class="fas fa-tools fa-10x text-primary opacity-75"></i>
                </div>
            </div>
        </div>
    </section>

    <!-- Reviews Section with Slider -->
    <section id="reviews" class="reviews-section">
        <div class="container">
            <h2 class="text-center mb-5" style="color: #2c3e50; font-weight: 700;">Wat Onze Klanten Zeggen</h2>
            
            <div class="reviews-container">
                <div class="overall-rating">
                    <h3>Onze Waardering</h3>
                    <div class="rating-display" id="overallRating">4.6</div>
                    <div class="stars-display" id="overallStars">★★★★★</div>
                    <p id="totalReviews">Gebaseerd op reviews van de afgelopen 2 jaar</p>
                </div>
                
                <div class="reviews-slider-container">
                    <div class="reviews-slider" id="reviewsSlider">
                        <!-- Reviews will be loaded here -->
                    </div>
                </div>
                
                <div class="slider-navigation">
                    <button class="nav-button" id="prevBtn">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <div class="slider-dots" id="sliderDots"></div>
                    <button class="nav-button" id="nextBtn">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Booking Section -->
    <section id="booking" class="py-5">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <div class="booking-form">
                        <h2 class="form-title">Maak een Afspraak</h2>
                        <form id="bookingForm">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="name" class="form-label">Naam *</label>
                                    <input type="text" class="form-control" id="name" name="name" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="email" class="form-label">Email *</label>
                                    <input type="email" class="form-control" id="email" name="email" required>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="phone" class="form-label">Telefoon</label>
                                    <input type="tel" class="form-control" id="phone" name="phone">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="service" class="form-label">Service</label>
                                    <select class="form-control" id="service" name="service">
                                        <option value="">Kies een service</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="date" class="form-label">Datum *</label>
                                    <input type="date" class="form-control" id="date" name="date" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="time" class="form-label">Tijd *</label>
                                    <select class="form-control" id="time" name="time" required>
                                        <option value="">Selecteer tijd</option>
                                        <option value="09:00">09:00</option>
                                        <option value="10:00">10:00</option>
                                        <option value="11:00">11:00</option>
                                        <option value="14:00">14:00</option>
                                        <option value="15:00">15:00</option>
                                        <option value="16:00">16:00</option>
                                    </select>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="message" class="form-label">Bericht</label>
                                <textarea class="form-control" id="message" name="message" rows="3"></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary w-100">
                                <i class="fas fa-calendar-check"></i> Afspraak Bevestigen
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Section with Map -->
    <section id="contact" class="py-5 bg-dark text-white">
        <div class="container">
            <div class="row">
                <div class="col-lg-6 mb-4">
                    <h5>Koree Autoservice</h5>
                    <p class="mb-3">Uw betrouwbare partner voor alle autoservices in Maassluis en omgeving.</p>
                    
                    <div class="contact-info">
                        <p><i class="fas fa-map-marker-alt me-2"></i> Fenacoliuslaan 60-64, 3143 AE Maassluis</p>
                        <p><i class="fas fa-phone me-2"></i> +31 6 23967989</p>
                        <p><i class="fas fa-envelope me-2"></i> info@koreeautoservice.nl</p>
                        <p><i class="fab fa-whatsapp me-2"></i> 
                            <a href="https://wa.me/31623967989" class="text-white" target="_blank">
                                WhatsApp Direct
                            </a>
                        </p>
                    </div>
                    
                    <div class="opening-hours mt-4">
                        <h5>Openingstijden</h5>
                        <p>Maandag - Vrijdag: 8:00 - 17:00</p>
                        <p>Zaterdag: 9:00 - 14:00</p>
                        <p>Zondag: Gesloten</p>
                    </div>
                </div>
                
                <div class="col-lg-6">
                    <h5>Onze Locatie</h5>
                    <div class="map-container">
                        <iframe 
                            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2460.8234567890123!2d4.2506789!3d51.9234567!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x47c5b1234567890a%3A0x1234567890abcdef!2sFenacoliuslaan%2060-64%2C%203143%20AE%20Maassluis!5e0!3m2!1snl!2snl!4v1234567890123!5m2!1snl!2snl"
                            width="100%" 
                            height="250" 
                            style="border:0; border-radius: 10px;" 
                            allowfullscreen="" 
                            loading="lazy" 
                            referrerpolicy="no-referrer-when-downgrade">
                        </iframe>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Load services for the form and services section
        document.addEventListener('DOMContentLoaded', function() {
            let currentSlide = 0;
            let totalSlides = 0;

            // Load services
            fetch('/api/services')
                .then(response => response.json())
                .then(data => {
                    const serviceSelect = document.getElementById('service');
                    const servicesContainer = document.getElementById('servicesContainer');
                    
                    data.services.forEach(service => {
                        // Add to select dropdown
                        const option = document.createElement('option');
                        option.value = service.name;
                        option.textContent = service.name;
                        serviceSelect.appendChild(option);
                        
                        // Add to services section
                        const serviceCard = `
                            <div class="col-md-6 col-lg-4">
                                <div class="service-card">
                                    <div class="service-icon">
                                        <i class="fas fa-wrench"></i>
                                    </div>
                                    <h4>${service.name}</h4>
                                    <p>${service.description}</p>
                                    <small class="text-muted">Geschatte duur: ${service.duration} minuten</small>
                                </div>
                            </div>
                        `;
                        servicesContainer.innerHTML += serviceCard;
                    });
                });

            // Load reviews with slider functionality
            fetch('/api/reviews')
                .then(response => response.json())
                .then(data => {
                    console.log('Reviews API Response:', data); // Debug log
                    
                    if (data.success && data.data) {
                        // Update overall rating
                        document.getElementById('overallRating').textContent = data.data.rating || '4.6';
                        
                        if (data.data.reviews && data.data.reviews.length > 0) {
                            document.getElementById('totalReviews').textContent = data.data.message || 
                                `Gebaseerd op ${data.data.reviews.length} beoordelingen van de afgelopen 2 jaar`;
                            
                            // Initialize slider
                            initReviewsSlider(data.data.reviews);
                        } else {
                            // No reviews found
                            document.getElementById('totalReviews').textContent = 
                                data.data.message || 'Geen recente beoordelingen beschikbaar';
                            document.getElementById('reviewsSlider').innerHTML = 
                                '<div class="text-center p-4"><i class="fas fa-star text-muted fa-3x mb-3"></i><br>Geen beoordelingen van de afgelopen 2 jaar gevonden</div>';
                            // Hide navigation
                            document.querySelector('.slider-navigation').style.display = 'none';
                        }
                    } else {
                        document.getElementById('reviewsSlider').innerHTML = 
                            '<div class="text-center">Geen beoordelingen beschikbaar.</div>';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('reviewsSlider').innerHTML = 
                        '<div class="alert alert-danger">Er is een fout opgetreden bij het laden van de reviews.</div>';
                });

            function initReviewsSlider(reviews) {
                const container = document.getElementById('reviewsSlider');
                const dotsContainer = document.getElementById('sliderDots');
                const reviewsPerSlide = 2;
                totalSlides = Math.ceil(reviews.length / reviewsPerSlide);
                
                // Clear existing content
                container.innerHTML = '';
                dotsContainer.innerHTML = '';
                
                // Create slides
                for (let i = 0; i < totalSlides; i++) {
                    const slideReviews = reviews.slice(i * reviewsPerSlide, (i + 1) * reviewsPerSlide);
                    const slideHTML = slideReviews.map(review => {
                        const stars = '★'.repeat(review.rating) + '☆'.repeat(5 - review.rating);
                        const localGuideBadge = review.is_local_guide ? 
                            '<span class="local-guide-badge ms-2">Local Guide</span>' : '';
                        
                        return `
                            <div class="review-card">
                                <div class="review-header">
                                    <img src="${review.profile_photo || 'https://via.placeholder.com/60'}" 
                                         class="reviewer-avatar me-3" alt="">
                                    <div class="reviewer-info">
                                        <h5 class="mb-1">
                                            ${review.author}
                                            ${localGuideBadge}
                                        </h5>
                                        <div class="review-rating">${stars}</div>
                                        <div class="review-date">${review.time}</div>
                                    </div>
                                </div>
                                <p class="review-text">${review.text}</p>
                            </div>
                        `;
                    }).join('');
                    
                    const slideDiv = document.createElement('div');
                    slideDiv.className = 'slide';
                    slideDiv.style.cssText = 'display: flex; gap: 30px; min-width: 100%; justify-content: center;';
                    slideDiv.innerHTML = slideHTML;
                    container.appendChild(slideDiv);
                    
                    // Create dot
                    const dot = document.createElement('button');
                    dot.className = `dot ${i === 0 ? 'active' : ''}`;
                    dot.addEventListener('click', () => {
                        currentSlide = i;
                        updateSlider();
                    });
                    dotsContainer.appendChild(dot);
                }
                
                // Navigation event listeners
                document.getElementById('prevBtn').addEventListener('click', () => {
                    if (currentSlide > 0) {
                        currentSlide--;
                        updateSlider();
                    }
                });
                
                document.getElementById('nextBtn').addEventListener('click', () => {
                    if (currentSlide < totalSlides - 1) {
                        currentSlide++;
                        updateSlider();
                    }
                });
                
                updateSlider();
                
                // Auto advance every 5 seconds
                setInterval(() => {
                    currentSlide = (currentSlide + 1) % totalSlides;
                    updateSlider();
                }, 5000);
            }

            function updateSlider() {
                const slider = document.getElementById('reviewsSlider');
                if (slider && totalSlides > 0) {
                    const translateX = -currentSlide * 100;
                    slider.style.transform = `translateX(${translateX}%)`;
                    
                    // Update dots
                    document.querySelectorAll('.dot').forEach((dot, index) => {
                        dot.classList.toggle('active', index === currentSlide);
                    });
                    
                    // Update navigation buttons
                    const prevBtn = document.getElementById('prevBtn');
                    const nextBtn = document.getElementById('nextBtn');
                    if (prevBtn) prevBtn.disabled = currentSlide === 0;
                    if (nextBtn) nextBtn.disabled = currentSlide === totalSlides - 1;
                }
            }

            // Booking form handler
            document.getElementById('bookingForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const formData = new FormData(this);
                
                fetch('/api/book', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.message) {
                        alert('Afspraak bevestigd!');
                        this.reset();
                    } else {
                        alert(data.error);
                    }
                })
                .catch(error => {
                    alert('Er is een fout opgetreden. Probeer het opnieuw.');
                });
            });

            // Set minimum date to today
            document.getElementById('date').min = new Date().toISOString().split('T')[0];
        });

        // Smooth scrolling for navigation links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
    </script>
</body>
</html>